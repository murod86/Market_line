Feb 27, 2026, 3:25:58 PM GMT+5
Error
Attributes
Raw Data
		`;await n.execute(y`CREATE SCHEMA IF NOT EXISTS ${y.identifier(a)}`),await n.execute(s);let c=(await n.all(y`select id, hash, created_at from ${y.identifier(a)}.${y.identifier(r)} order by created_at desc limit 1`))[0];await n.transaction(async u=>{for await(let l of e)if(!c||Number(c.created_at)<l.folderMillis){for(let p of l.sql)await u.execute(y.raw(p));await u.execute(y`insert into ${y.identifier(a)}.${y.identifier(r)} ("hash", "created_at") values(${l.hash}, ${l.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let n=[y`with `];for(let[i,r]of e.entries())n.push(y`${y.identifier(r._.alias)} as (${r._.sql})`),i<e.length-1&&n.push(y`, `);return n.push(y` `),y.join(n)}buildDeleteQuery({table:e,where:n,returning:i,withList:r}){let a=this.buildWithCTE(r),s=i?y` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,o=n?y` where ${n}`:void 0;return y`${a}delete from ${e}${o}${s}`}buildUpdateSet(e,n){let i=e[R.Symbol.Columns],r=Object.keys(i).filter(s=>n[s]!==void 0||i[s]?.onUpdateFn!==void 0),a=r.length;return y.join(r.flatMap((s,o)=>{let c=i[s],u=n[s]??y.param(c.onUpdateFn(),c),l=y`${y.identifier(this.casing.getColumnCasing(c))} = ${u}`;return o<a-1?[l,y.raw(", ")]:[l]}))}buildUpdateQuery({table:e,set:n,where:i,returning:r,withList:a,from:s,joins:o}){let c=this.buildWithCTE(a),u=e[Je.Symbol.Name],l=e[Je.Symbol.Schema],p=e[Je.Symbol.OriginalName],d=u===p?void 0:u,f=y`${l?y`${y.identifier(l)}.`:void 0}${y.identifier(p)}${d&&y` ${y.identifier(d)}`}`,h=this.buildUpdateSet(e,n),m=s&&y.join([y.raw(" from "),this.buildFromTable(s)]),v=this.buildJoins(o),b=r?y` returning ${this.buildSelection(r,{isSingleTable:!s})}`:void 0,w=i?y` where ${i}`:void 0;return y`${c}update ${f} set ${h}${m}${v}${w}${b}`}buildSelection(e,{isSingleTable:n=!1}={}){let i=e.length,r=e.flatMap(({field:a},s)=>{let o=[];if(S(a,F.Aliased)&&a.isSelectionField)o.push(y.identifier(a.fieldAlias));else if(S(a,F.Aliased)||S(a,F)){let c=S(a,F.Aliased)?a.sql:a;n?o.push(new F(c.queryChunks.map(u=>S(u,O)?y.identifier(this.casing.getColumnCasing(u)):u))):o.push(c),S(a,F.Aliased)&&o.push(y` as ${y.identifier(a.fieldAlias)}`)}else S(a,fe)&&(n?o.push(y.identifier(this.casing.getColumnCasing(a))):o.push(a));return s<i-1&&o.push(y`, `),o});return y.join(r)}buildJoins(e){if(!e||e.length===0)return;let n=[];for(let[i,r]of e.entries()){i===0&&n.push(y` `);let a=r.table,s=r.lateral?y` lateral`:void 0;if(S(a,Je)){let o=a[Je.Symbol.Name],c=a[Je.Symbol.Schema],u=a[Je.Symbol.OriginalName],l=o===u?void 0:r.alias;n.push(y`${y.raw(r.joinType)} join${s} ${c?y`${y.identifier(c)}.`:void 0}${y.identifier(u)}${l&&y` ${y.identifier(l)}`} on ${r.on}`)}else if(S(a,lt)){let o=a[be].name,c=a[be].schema,u=a[be].originalName,l=o===u?void 0:r.alias;n.push(y`${y.raw(r.joinType)} join${s} ${c?y`${y.identifier(c)}.`:void 0}${y.identifier(u)}${l&&y` ${y.identifier(l)}`} on ${r.on}`)}else n.push(y`${y.raw(r.joinType)} join${s} ${a} on ${r.on}`);i<e.length-1&&n.push(y` `)}return y.join(n)}buildFromTable(e){if(S(e,R)&&e[R.Symbol.OriginalName]!==e[R.Symbol.Name]){let n=y`${y.identifier(e[R.Symbol.OriginalName])}`;return e[R.Symbol.Schema]&&(n=y`${y.identifier(e[R.Symbol.Schema])}.${n}`),y`${n} ${y.identifier(e[R.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:n,fieldsFlat:i,where:r,having:a,table:s,joins:o,orderBy:c,groupBy:u,limit:l,offset:p,lockingClause:d,distinct:f,setOperators:h}){let m=i??Ut(n);for(let ce of m)if(S(ce.field,fe)&&bt(ce.field.table)!==(S(s,Be)?s._.alias:S(s,Wn)?s[be].name:S(s,F)?void 0:bt(s))&&!(le=>o?.some(({alias:se})=>se===(le[R.Symbol.IsAlias]?bt(le):le[R.Symbol.BaseName])))(ce.field.table)){let le=bt(ce.field.table);throw new Error(`Your "${ce.path.join("->")}" field references a column "${le}"."${ce.field.name}", but the table "${le}" is not part of the query! Did you forget to join it?`)}let v=!o||o.length===0,b=this.buildWithCTE(e),w;f&&(w=f===!0?y` distinct`:y` distinct on (${y.join(f.on,y`, `)})`);let _=this.buildSelection(m,{isSingleTable:v}),E=this.buildFromTable(s),A=this.buildJoins(o),C=r?y` where ${r}`:void 0,T=a?y` having ${a}`:void 0,I;c&&c.length>0&&(I=y` order by ${y.join(c,y`, `)}`);let $;u&&u.length>0&&($=y` group by ${y.join(u,y`, `)}`);let pe=typeof l=="object"||typeof l=="number"&&l>=0?y` limit ${l}`:void 0,Fe=p?y` offset ${p}`:void 0,_e=y.empty();if(d){let ce=y` for ${y.raw(d.strength)}`;d.config.of&&ce.append(y` of ${y.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],y`, `)}`),d.config.noWait?ce.append(y` no wait`):d.config.skipLocked&&ce.append(y` skip locked`),_e.append(ce)}let X=y`${b}select${w} ${_} from ${E}${A}${C}${$}${T}${I}${pe}${Fe}${_e}`;return h.length>0?this.buildSetOperations(X,h):X}buildSetOperations(e,n){let[i,...r]=n;if(!i)throw new Error("Cannot pass undefined values to any set operator");return r.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:i}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:i}),r)}buildSetOperationQuery({leftSelect:e,setOperator:{type:n,isAll:i,rightSelect:r,limit:a,orderBy:s,offset:o}}){let c=y`(${e.getSQL()}) `,u=y`(${r.getSQL()})`,l;if(s&&s.length>0){let h=[];for(let m of s)if(S(m,O))h.push(y.identifier(m.name));else if(S(m,F)){for(let v=0;v<m.queryChunks.length;v++){let b=m.queryChunks[v];S(b,O)&&(m.queryChunks[v]=y.identifier(b.name))}h.push(y`${m}`)}else h.push(y`${m}`);l=y` order by ${y.join(h,y`, `)} `}let p=typeof a=="object"||typeof a=="number"&&a>=0?y` limit ${a}`:void 0,d=y.raw(`${n} ${i?"all ":""}`),f=o?y` offset ${o}`:void 0;return y`${c}${d}${u}${l}${p}${f}`}buildInsertQuery({table:e,values:n,onConflict:i,returning:r,withList:a,select:s,overridingSystemValue_:o}){let c=[],u=e[R.Symbol.Columns],l=Object.entries(u).filter(([b,w])=>!w.shouldDisableInsert()),p=l.map(([,b])=>y.identifier(this.casing.getColumnCasing(b)));if(s){let b=n;S(b,F)?c.push(b):c.push(b.getSQL())}else{let b=n;c.push(y.raw("values "));for(let[w,_]of b.entries()){let E=[];for(let[A,C]of l){let T=_[A];if(T===void 0||S(T,_t)&&T.value===void 0)if(C.defaultFn!==void 0){let I=C.defaultFn(),$=S(I,F)?I:y.param(I,C);E.push($)}else if(!C.default&&C.onUpdateFn!==void 0){let I=C.onUpdateFn(),$=S(I,F)?I:y.param(I,C);E.push($)}else E.push(y`default`);else E.push(T)}c.push(E),w<b.length-1&&c.push(y`, `)}}let d=this.buildWithCTE(a),f=y.join(c),h=r?y` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0,m=i?y` on conflict ${i}`:void 0,v=o===!0?y`overriding system value `:void 0;return y`${d}insert into ${e} ${p} ${v}${f}${m}${h}`}buildRefreshMaterializedViewQuery({view:e,concurrently:n,withNoData:i}){let r=n?y` concurrently`:void 0,a=i?y` with no data`:void 0;return y`refresh materialized view${r} ${e}${a}`}prepareTyping(e){return S(e,as)||S(e,rs)?"json":S(e,os)?"decimal":S(e,cs)?"time":S(e,us)||S(e,ls)?"timestamp":S(e,ns)||S(e,is)?"date":S(e,ps)?"uuid":"none"}sqlToQuery(e,n){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:n})}buildRelationalQueryWithoutPK({fullSchema:e,schema:n,tableNamesMap:i,table:r,tableConfig:a,queryConfig:s,tableAlias:o,nestedQueryRelation:c,joinOn:u}){let l=[],p,d,f=[],h,m=[];if(s===!0)l=Object.entries(a.columns).map(([w,_])=>({dbKey:_.name,tsKey:w,field:_n(_,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let b=Object.fromEntries(Object.entries(a.columns).map(([T,I])=>[T,_n(I,o)]));if(s.where){let T=typeof s.where=="function"?s.where(b,FC()):s.where;h=T&&Xa(T,o)}let w=[],_=[];if(s.columns){let T=!1;for(let[I,$]of Object.entries(s.columns))$!==void 0&&I in a.columns&&(!T&&$===!0&&(T=!0),_.push(I));_.length>0&&(_=T?_.filter(I=>s.columns?.[I]===!0):Object.keys(a.columns).filter(I=>!_.includes(I)))}else _=Object.keys(a.columns);for(let T of _){let I=a.columns[T];w.push({tsKey:T,value:I})}let E=[];s.with&&(E=Object.entries(s.with).filter(T=>!!T[1]).map(([T,I])=>({tsKey:T,queryConfig:I,relation:a.relations[T]})));let A;if(s.extras){A=typeof s.extras=="function"?s.extras(b,{sql:y}):s.extras;for(let[T,I]of Object.entries(A))w.push({tsKey:T,value:tf(I,o)})}for(let{tsKey:T,value:I}of w)l.push({dbKey:S(I,F.Aliased)?I.fieldAlias:a.columns[T].name,tsKey:T,field:S(I,fe)?_n(I,o):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let C=typeof s.orderBy=="function"?s.orderBy(b,DC()):s.orderBy??[];Array.isArray(C)||(C=[C]),f=C.map(T=>S(T,fe)?_n(T,o):Xa(T,o)),p=s.limit,d=s.offset;for(let{tsKey:T,queryConfig:I,relation:$}of E){let pe=LC(n,i,$),Fe=Yi($.referencedTable),_e=i[Fe],X=`${o}_${T}`,ce=zn(...pe.fields.map((G,Oe)=>B(_n(pe.references[Oe],X),_n(G,o)))),le=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:n,tableNamesMap:i,table:e[_e],tableConfig:n[_e],queryConfig:S($,pi)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:X,joinOn:ce,nestedQueryRelation:$}),se=y`${y.identifier(X)}.${y.identifier("data")}`.as(T);m.push({on:y`true`,table:new Be(le.sql,{},X),alias:X,joinType:"left",lateral:!0}),l.push({dbKey:T,tsKey:T,field:se,relationTableTsKey:_e,isJson:!0,selection:le.selection})}}if(l.length===0)throw new Ya({message:`No fields selected for table "${a.tsName}" ("${o}")`});let v;if(h=zn(u,h),c){let b=y`json_build_array(${y.join(l.map(({field:E,tsKey:A,isJson:C})=>C?y`${y.identifier(`${o}_${A}`)}.${y.identifier("data")}`:S(E,F.Aliased)?E.sql:E),y`, `)})`;S(c,ds)&&(b=y`coalesce(json_agg(${b}${f.length>0?y` order by ${y.join(f,y`, `)}`:void 0}), '[]'::json)`);let w=[{dbKey:"data",tsKey:"data",field:b.as("data"),isJson:!0,relationTableTsKey:a.tsName,selection:l}];p!==void 0||d!==void 0||f.length>0?(v=this.buildSelectQuery({table:Ja(r,o),fields:{},fieldsFlat:[{path:[],field:y.raw("*")}],where:h,limit:p,offset:d,orderBy:f,setOperators:[]}),h=void 0,p=void 0,d=void 0,f=[]):v=Ja(r,o),v=this.buildSelectQuery({table:S(v,Je)?v:new Be(v,{},o),fields:{},fieldsFlat:w.map(({field:E})=>({path:[],field:S(E,fe)?_n(E,o):E})),joins:m,where:h,limit:p,offset:d,orderBy:f,setOperators:[]})}else v=this.buildSelectQuery({table:Ja(r,o),fields:{},fieldsFlat:l.map(({field:b})=>({path:[],field:S(b,fe)?_n(b,o):b})),joins:m,where:h,limit:p,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:a.tsName,sql:v,selection:l}}}});var mu,q2=k(()=>{N();mu=class{static[x]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}});function aa(t,e){return(n,i,...r)=>{let a=[i,...r].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of a)if(!es(n.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return n.addSetOperators(a)}}var ot,sv,hu,tL,nL,iL,rL,aL,sL,oL,ov=k(()=>{N();du();q2();$n();hi();$e();wn();wt();Mn();he();he();Ln();ot=class{static[x]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let n=!!this.fields,i=e,r;return this.fields?r=this.fields:S(i,Be)?r=Object.fromEntries(Object.keys(i._.selectedFields).map(a=>[a,i[a]])):S(i,Wn)?r=i[be].selectedFields:S(i,F)?r={}:r=tr(i),new hu({table:i,fields:r,isPartialSelect:n,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},sv=class extends mu{static[x]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:n,isPartialSelect:i,session:r,dialect:a,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...n},distinct:o,setOperators:[]},this.isPartialSelect=i,this.session=r,this.dialect=a,this._={selectedFields:n},this.tableName=Un(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(n,i)=>{let r=this.tableName,a=Un(n);if(typeof a=="string"&&this.config.joins?.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof r=="string"&&(this.config.fields={[r]:this.config.fields}),typeof a=="string"&&!S(n,F))){let s=S(n,Be)?n._.selectedFields:S(n,lt)?n[be].selectedFields:n[R.Symbol.Columns];this.config.fields[a]=s}if(typeof i=="function"&&(i=i(new Proxy(this.config.fields,new ve({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:i,table:n,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,n){return i=>{let r=typeof i=="function"?i(tL()):i;if(!es(this.getSelectedFields(),r.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:n,rightSelect:r}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new ve({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new ve({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let n=e[0](new Proxy(this.config.fields,new ve({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(n)?n:[n]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let n=e[0](new Proxy(this.config.fields,new ve({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),i=Array.isArray(n)?n:[n];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=i:this.config.orderBy=i}else{let n=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,n={}){return this.config.lockingClause={strength:e,config:n},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...n}=this.dialect.sqlToQuery(this.getSQL());return n}as(e){return new Proxy(new Be(this.getSQL(),this.config.fields,e),new ve({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new ve({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},hu=class extends sv{static[x]="PgSelect";_prepare(e){let{session:n,config:i,dialect:r,joinsNotNullableMap:a,authToken:s}=this;if(!n)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ye.startActiveSpan("drizzle.prepareQuery",()=>{let o=Ut(i.fields),c=n.prepareQuery(r.sqlToQuery(this.getSQL()),o,e,!0);return c.joinsNotNullableMap=a,c.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};iC(hu,[st]);tL=()=>({union:nL,unionAll:iL,intersect:rL,intersectAll:aL,except:sL,exceptAll:oL}),nL=aa("union",!1),iL=aa("union",!0),rL=aa("intersect",!1),aL=aa("intersect",!0),sL=aa("except",!1),oL=aa("except",!0)});var Kn,vu=k(()=>{N();fu();hi();wn();ov();Kn=class{static[x]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=S(e,vi)?e:void 0,this.dialectConfig=S(e,vi)?void 0:e}$with=(e,n)=>{let i=this;return{as:a=>(typeof a=="function"&&(a=a(i)),new Proxy(new Hr(a.getSQL(),n??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new ve({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let n=this;function i(s){return new ot({fields:s??void 0,session:void 0,dialect:n.getDialect(),withList:e})}function r(s){return new ot({fields:s??void 0,session:void 0,dialect:n.getDialect(),distinct:!0})}function a(s,o){return new ot({fields:o??void 0,session:void 0,dialect:n.getDialect(),distinct:{on:s}})}return{select:i,selectDistinct:r,selectDistinctOn:a}}select(e){return new ot({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new ot({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,n){return new ot({fields:n??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new vi(this.dialectConfig)),this.dialect}}});var ks,gu,R2=k(()=>{N();$n();hi();$e();wt();Mn();he();vu();ks=class{constructor(e,n,i,r,a){this.table=e,this.session=n,this.dialect=i,this.withList=r,this.overridingSystemValue_=a}static[x]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let n=e.map(i=>{let r={},a=this.table[R.Symbol.Columns];for(let s of Object.keys(i)){let o=i[s];r[s]=S(o,F)?o:new _t(o,a[s])}return r});return new gu(this.table,n,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let n=typeof e=="function"?e(new Kn):e;if(!S(n,F)&&!es(this.table[Nc],n._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new gu(this.table,n,this.session,this.dialect,this.withList,!0)}},gu=class extends st{constructor(e,n,i,r,a,s,o){super(),this.session=i,this.dialect=r,this.config={table:e,values:n,withList:a,select:s,overridingSystemValue_:o}}static[x]="PgInsert";config;returning(e=this.config.table[R.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Ut(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=y`do nothing`;else{let n="";n=Array.isArray(e.target)?e.target.map(r=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(r))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let i=e.where?y` where ${e.where}`:void 0;this.config.onConflict=y`(${y.raw(n)})${i} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let n=e.where?y` where ${e.where}`:void 0,i=e.targetWhere?y` where ${e.targetWhere}`:void 0,r=e.setWhere?y` where ${e.setWhere}`:void 0,a=this.dialect.buildUpdateSet(this.config.table,zc(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=y`(${y.raw(s)})${i} do update set ${a}${n}${r}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...n}=this.dialect.sqlToQuery(this.getSQL());return n}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ve({alias:bt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}});var xu,cv=k(()=>{N();$n();Mn();xu=class extends st{constructor(e,n,i){super(),this.session=n,this.dialect=i,this.config={view:e}}static[x]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...n}=this.dialect.sqlToQuery(this.getSQL());return n}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))}});var F2=k(()=>{});var Ts,uv,D2=k(()=>{N();ir();$n();hi();$e();wn();wt();he();Ln();Ts=class{constructor(e,n,i,r){this.table=e,this.session=n,this.dialect=i,this.withList=r}static[x]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new uv(this.table,zc(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},uv=class extends st{constructor(e,n,i,r,a){super(),this.session=i,this.dialect=r,this.config={set:n,table:e,withList:a,joins:[]},this.tableName=Un(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[x]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let n=e,i=Un(n);return typeof i=="string"&&(this.joinsNotNullableMap[i]=!0),this.config.from=n,this}getTableLikeFields(e){return S(e,Je)?e[R.Symbol.Columns]:S(e,Be)?e._.selectedFields:e[be].selectedFields}createJoin(e){return(n,i)=>{let r=Un(n);if(typeof r=="string"&&this.config.joins.some(a=>a.alias===r))throw new Error(`Alias "${r}" is already used in this query`);if(typeof i=="function"){let a=this.config.from&&!S(this.config.from,F)?this.getTableLikeFields(this.config.from):void 0;i=i(new Proxy(this.config.table[R.Symbol.Columns],new ve({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new ve({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:i,table:n,joinType:e,alias:r}),typeof r=="string")switch(e){case"left":{this.joinsNotNullableMap[r]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[r]=!0;break}case"inner":{this.joinsNotNullableMap[r]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[r]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[R.Symbol.Columns]),this.config.from)){let n=Un(this.config.from);if(typeof n=="string"&&this.config.from&&!S(this.config.from,F)){let i=this.getTableLikeFields(this.config.from);e[n]=i}for(let i of this.config.joins){let r=Un(i.table);if(typeof r=="string"&&!S(i.table,F)){let a=this.getTableLikeFields(i.table);e[r]=a}}}return this.config.returningFields=e,this.config.returning=Ut(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...n}=this.dialect.sqlToQuery(this.getSQL());return n}_prepare(e){let n=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return n.joinsNotNullableMap=this.joinsNotNullableMap,n}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ve({alias:bt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}});var lv=k(()=>{O2();R2();vu();cv();ov();F2();D2()});var yu,M2=k(()=>{N();$e();yu=class t extends F{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[x]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,n){return y`(select count(*) from ${e}${y.raw(" where ").if(n)}${n})`}static buildCount(e,n){return y`select count(*) as count from ${e}${y.raw(" where ").if(n)}${n};`}setToken(e){return this.token=e,this}then(e,n){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,n)}catch(e){return this.then(void 0,e)}finally(e){return this.then(n=>(e?.(),n),n=>{throw e?.(),n})}}});var bu,wu,L2=k(()=>{N();$n();fs();Mn();bu=class{constructor(e,n,i,r,a,s,o){this.fullSchema=e,this.schema=n,this.tableNamesMap=i,this.table=r,this.tableConfig=a,this.dialect=s,this.session=o}static[x]="PgRelationalQueryBuilder";findMany(e){return new wu(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new wu(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},wu=class extends st{constructor(e,n,i,r,a,s,o,c,u){super(),this.fullSchema=e,this.schema=n,this.tableNamesMap=i,this.table=r,this.tableConfig=a,this.dialect=s,this.session=o,this.config=c,this.mode=u}static[x]="PgRelationalQuery";_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>{let{query:n,builtQuery:i}=this._toSQL();return this.session.prepareQuery(i,void 0,e,!0,(r,a)=>{let s=r.map(o=>Vc(this.schema,this.tableConfig,o,n.selection,a));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),n=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:n}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}}});var _u,B2=k(()=>{N();$n();_u=class extends st{constructor(e,n,i,r){super(),this.execute=e,this.sql=n,this.query=i,this.mapBatchResult=r}static[x]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,n){return n?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}}});var sa,Su=k(()=>{N();lv();hi();$e();wn();M2();L2();B2();cv();sa=class{constructor(e,n,i){if(this.dialect=e,this.session=n,this._=i?{schema:i.schema,fullSchema:i.fullSchema,tableNamesMap:i.tableNamesMap,session:n}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:n},this.query={},this._.schema)for(let[r,a]of Object.entries(this._.schema))this.query[r]=new bu(i.fullSchema,this._.schema,this._.tableNamesMap,i.fullSchema[r],a,e,n)}static[x]="PgDatabase";query;$with=(e,n)=>{let i=this;return{as:a=>(typeof a=="function"&&(a=a(new Kn(i.dialect))),new Proxy(new Hr(a.getSQL(),n??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new ve({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,n){return new yu({source:e,filters:n,session:this.session})}with(...e){let n=this;function i(u){return new ot({fields:u??void 0,session:n.session,dialect:n.dialect,withList:e})}function r(u){return new ot({fields:u??void 0,session:n.session,dialect:n.dialect,withList:e,distinct:!0})}function a(u,l){return new ot({fields:l??void 0,session:n.session,dialect:n.dialect,withList:e,distinct:{on:u}})}function s(u){return new Ts(u,n.session,n.dialect,e)}function o(u){return new ks(u,n.session,n.dialect,e)}function c(u){return new Es(u,n.session,n.dialect,e)}return{select:i,selectDistinct:r,selectDistinctOn:a,update:s,insert:o,delete:c}}select(e){return new ot({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new ot({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,n){return new ot({fields:n??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new Ts(e,this.session,this.dialect)}insert(e){return new ks(e,this.session,this.dialect)}delete(e){return new Es(e,this.session,this.dialect)}refreshMaterializedView(e){return new xu(e,this.session,this.dialect)}authToken;execute(e){let n=typeof e=="string"?y.raw(e):e.getSQL(),i=this.dialect.sqlToQuery(n),r=this.session.prepareQuery(i,void 0,void 0,!1);return new _u(()=>r.execute(void 0,this.authToken),n,i,a=>r.mapResult(a,!0))}transaction(e,n){return this.session.transaction(e,n)}}});var z2=k(()=>{});var $2,pv,U2=k(()=>{N();$2=class{constructor(e,n){this.name=e,this.value=n}static[x]="PgCheckBuilder";brand;build(e){return new pv(e,this)}},pv=class{constructor(e,n){this.table=e,this.name=n.name,this.value=n.value}static[x]="PgCheck";name;value}});var Q2,Ps,dv,V2=k(()=>{$e();N();pu();Q2=class{constructor(e,n){this.unique=e,this.name=n}static[x]="PgIndexBuilderOn";on(...e){return new Ps(e.map(n=>{if(S(n,F))return n;n=n;let i=new Vr(n.name,!!n.keyAsName,n.columnType,n.indexConfig);return n.indexConfig=JSON.parse(JSON.stringify(n.defaultConfig)),i}),this.unique,!1,this.name)}onOnly(...e){return new Ps(e.map(n=>{if(S(n,F))return n;n=n;let i=new Vr(n.name,!!n.keyAsName,n.columnType,n.indexConfig);return n.indexConfig=n.defaultConfig,i}),this.unique,!0,this.name)}using(e,...n){return new Ps(n.map(i=>{if(S(i,F))return i;i=i;let r=new Vr(i.name,!!i.keyAsName,i.columnType,i.indexConfig);return i.indexConfig=JSON.parse(JSON.stringify(i.defaultConfig)),r}),this.unique,!0,this.name,e)}},Ps=class{static[x]="PgIndexBuilder";config;constructor(e,n,i,r,a="btree"){this.config={name:r,columns:e,unique:n,only:i,method:a}}concurrently(){return this.config.concurrently=!0,this}with(e){return this.config.with=e,this}where(e){return this.config.where=e,this}build(e){return new dv(this.config,e)}},dv=class{static[x]="PgIndex";config;constructor(e,n){this.config={...e,table:n}}}});var H2,W2=k(()=>{N();H2=class{constructor(e,n){this.name=e,n&&(this.as=n.as,this.for=n.for,this.to=n.to,this.using=n.using,this.withCheck=n.withCheck)}static[x]="PgPolicy";as;for;to;using;withCheck;_linkedTable;link(e){return this._linkedTable=e,this}}});var K2,G2=k(()=>{N();K2=class{constructor(e,n){this.name=e,n&&(this.createDb=n.createDb,this.createRole=n.createRole,this.inherit=n.inherit)}static[x]="PgRole";_existing;createDb;createRole;inherit;existing(){return this._existing=!0,this}}});function Z2(t,e,n){return new fv(t,e,n)}var fv,mv=k(()=>{N();fv=class{constructor(e,n,i){this.seqName=e,this.seqOptions=n,this.schema=i}static[x]="PgSequence"}});var hv,vv=k(()=>{hv=Symbol.for("drizzle:PgViewConfig")});function X2(t,e,n){return e?new xv(t,e,n):new gv(t,n)}function Y2(t,e,n){return e?new bv(t,e,n):new yv(t,n)}var Cu,gv,xv,Eu,yv,bv,As,J2,js,wv=k(()=>{N();hi();he();vu();ir();du();vv();Cu=class{constructor(e,n){this.name=e,this.schema=n}static[x]="PgDefaultViewBuilderCore";config={};with(e){return this.config.with=e,this}},gv=class extends Cu{static[x]="PgViewBuilder";as(e){typeof e=="function"&&(e=e(new Kn));let n=new ve({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),i=new Proxy(e.getSelectedFields(),n);return new Proxy(new As({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:i,query:e.getSQL().inlineParams()}}),n)}},xv=class extends Cu{static[x]="PgManualViewBuilder";columns;constructor(e,n,i){super(e,i),this.columns=tr(Xe(e,n))}existing(){return new Proxy(new As({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new ve({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(e){return new Proxy(new As({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:e.inlineParams()}}),new ve({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}},Eu=class{constructor(e,n){this.name=e,this.schema=n}static[x]="PgMaterializedViewBuilderCore";config={};using(e){return this.config.using=e,this}with(e){return this.config.with=e,this}tablespace(e){return this.config.tablespace=e,this}withNoData(){return this.config.withNoData=!0,this}},yv=class extends Eu{static[x]="PgMaterializedViewBuilder";as(e){typeof e=="function"&&(e=e(new Kn));let n=new ve({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),i=new Proxy(e.getSelectedFields(),n);return new Proxy(new js({pgConfig:{with:this.config.with,using:this.config.using,tablespace:this.config.tablespace,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:i,query:e.getSQL().inlineParams()}}),n)}},bv=class extends Eu{static[x]="PgManualMaterializedViewBuilder";columns;constructor(e,n,i){super(e,i),this.columns=tr(Xe(e,n))}existing(){return new Proxy(new js({pgConfig:{tablespace:this.config.tablespace,using:this.config.using,with:this.config.with,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new ve({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(e){return new Proxy(new js({pgConfig:{tablespace:this.config.tablespace,using:this.config.using,with:this.config.with,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:e.inlineParams()}}),new ve({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}},As=class extends Wn{static[x]="PgView";[hv];constructor({pgConfig:e,config:n}){super(n),e&&(this[hv]={with:e.with})}},J2=Symbol.for("drizzle:PgMaterializedViewConfig"),js=class extends Wn{static[x]="PgMaterializedView";[J2];constructor({pgConfig:e,config:n}){super(n),this[J2]={with:e?.with,using:e?.using,tablespace:e?.tablespace,withNoData:e?.withNoData}}}});var e8,t8=k(()=>{N();$e();Ic();mv();ir();wv();e8=class{constructor(e){this.schemaName=e}static[x]="PgSchema";table=(e,n,i)=>eh(e,n,i,this.schemaName);view=(e,n)=>X2(e,n,this.schemaName);materializedView=(e,n)=>Y2(e,n,this.schemaName);enum=(e,n)=>yS(e,n,this.schemaName);sequence=(e,n)=>Z2(e,n,this.schemaName);getSQL(){return new F([y.identifier(this.schemaName)])}shouldOmitSQLParens(){return!0}}});var ku,Tu,Pu,_v=k(()=>{N();Fc();Hc();Mn();Su();ku=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,n){return e}setToken(e){return this.authToken=e,this}static[x]="PgPreparedQuery";joinsNotNullableMap},Tu=class{constructor(e){this.dialect=e}static[x]="PgSession";execute(e,n){return ye.startActiveSpan("drizzle.operation",()=>ye.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(n).execute(void 0,n))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,n){let i=await this.execute(e,n);return Number(i[0].count)}},Pu=class extends sa{constructor(e,n,i,r=0){super(e,n,i),this.schema=i,this.nestedIndex=r}static[x]="PgTransaction";rollback(){throw new Rc}getTransactionConfigSQL(e){let n=[];return e.isolationLevel&&n.push(`isolation level ${e.isolationLevel}`),e.accessMode&&n.push(e.accessMode),typeof e.deferrable=="boolean"&&n.push(e.deferrable?"deferrable":"not deferrable"),y.raw(n.join(" "))}setTransaction(e){return this.session.execute(y`set transaction ${this.getTransactionConfigSQL(e)}`)}}});var n8=k(()=>{});var i8=k(()=>{});var r8=k(()=>{zd()});var Sv=k(()=>{z2();U2();pu();Su();fu();qd();V2();W2();nh();lv();G2();t8();mv();_v();n8();ir();Ld();i8();r8();vv();wv()});var a8,En,Cv,Au,Ev,kv=k(()=>{uu();N();Bc();Sv();_v();$e();Mn();he();({Pool:a8,types:En}=ra),Cv=class extends ku{constructor(e,n,i,r,a,s,o,c){super({sql:n,params:i}),this.client=e,this.params=i,this.logger=r,this.fields=a,this._isResponseInArrayMode=o,this.customResultMapper=c,this.rawQueryConfig={name:s,text:n,types:{getTypeParser:(u,l)=>u===En.builtins.TIMESTAMPTZ?p=>p:u===En.builtins.TIMESTAMP?p=>p:u===En.builtins.DATE?p=>p:u===En.builtins.INTERVAL?p=>p:En.getTypeParser(u,l)}},this.queryConfig={name:s,text:n,rowMode:"array",types:{getTypeParser:(u,l)=>u===En.builtins.TIMESTAMPTZ?p=>p:u===En.builtins.TIMESTAMP?p=>p:u===En.builtins.DATE?p=>p:u===En.builtins.INTERVAL?p=>p:En.getTypeParser(u,l)}}}static[x]="NodePgPreparedQuery";rawQueryConfig;queryConfig;async execute(e={}){return ye.startActiveSpan("drizzle.execute",async()=>{let n=ef(this.params,e);this.logger.logQuery(this.rawQueryConfig.text,n);let{fields:i,rawQueryConfig:r,client:a,queryConfig:s,joinsNotNullableMap:o,customResultMapper:c}=this;if(!i&&!c)return ye.startActiveSpan("drizzle.driver.execute",async l=>(l?.setAttributes({"drizzle.query.name":r.name,"drizzle.query.text":r.text,"drizzle.query.params":JSON.stringify(n)}),a.query(r,n)));let u=await ye.startActiveSpan("drizzle.driver.execute",l=>(l?.setAttributes({"drizzle.query.name":s.name,"drizzle.query.text":s.text,"drizzle.query.params":JSON.stringify(n)}),a.query(s,n)));return ye.startActiveSpan("drizzle.mapResponse",()=>c?c(u.rows):u.rows.map(l=>nC(i,l,o)))})}all(e={}){return ye.startActiveSpan("drizzle.execute",()=>{let n=ef(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,n),ye.startActiveSpan("drizzle.driver.execute",i=>(i?.setAttributes({"drizzle.query.name":this.rawQueryConfig.name,"drizzle.query.text":this.rawQueryConfig.text,"drizzle.query.params":JSON.stringify(n)}),this.client.query(this.rawQueryConfig,n).then(r=>r.rows)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},Au=class t extends Tu{constructor(e,n,i,r={}){super(n),this.client=e,this.schema=i,this.options=r,this.logger=r.logger??new Lc}static[x]="NodePgSession";logger;prepareQuery(e,n,i,r,a){return new Cv(this.client,e.sql,e.params,this.logger,n,i,r,a)}async transaction(e,n){let i=this.client instanceof a8?new t(await this.client.connect(),this.dialect,this.schema,this.options):this,r=new Ev(this.dialect,i,this.schema);await r.execute(y`begin${n?y` ${r.getTransactionConfigSQL(n)}`:void 0}`);try{let a=await e(r);return await r.execute(y`commit`),a}catch(a){throw await r.execute(y`rollback`),a}finally{this.client instanceof a8&&i.client.release()}}async count(e){let n=await this.execute(e);return Number(n.rows[0].count)}},Ev=class t extends Pu{static[x]="NodePgTransaction";async transaction(e){let n=`sp${this.nestedIndex+1}`,i=new t(this.dialect,this.session,this.schema,this.nestedIndex+1);await i.execute(y.raw(`savepoint ${n}`));try{let r=await e(i);return await i.execute(y.raw(`release savepoint ${n}`)),r}catch(r){throw await i.execute(y.raw(`rollback to savepoint ${n}`)),r}}}});function Is(t,e={}){let n=new vi({casing:e.casing}),i;e.logger===!0?i=new Mc:e.logger!==!1&&(i=e.logger);let r;if(e.schema){let c=MC(e.schema,BC);r={fullSchema:e.schema,schema:c.tables,tableNamesMap:c.tableNamesMap}}let s=new Tv(t,n,{logger:i}).createSession(r),o=new Pv(n,s,r);return o.$client=t,o}function ju(...t){if(typeof t[0]=="string"){let e=new ra.Pool({connectionString:t[0]});return Is(e,t[1])}if(aC(t[0])){let{connection:e,client:n,...i}=t[0];if(n)return Is(n,i);let r=typeof e=="string"?new ra.Pool({connectionString:e}):new ra.Pool(e);return Is(r,i)}return Is(t[0],t[1])}var Tv,Pv,s8=k(()=>{uu();N();Bc();Su();fu();fs();he();kv();Tv=class{constructor(e,n,i={}){this.client=e,this.dialect=n,this.options=i}static[x]="NodePgDriver";createSession(e){return new Au(this.client,this.dialect,e,{logger:this.options.logger})}},Pv=class extends sa{static[x]="NodePgDatabase"};(t=>{function e(n){return Is({},n)}t.mock=e})(ju||(ju={}))});var o8=k(()=>{s8();kv()});function Le(t,e){return e.includes(t.columnType)}function cL(t){return"enumValues"in t&&Array.isArray(t.enumValues)&&t.enumValues.length>0}function c8(t,e){let n=e?.zodInstance??xe,i=e?.coerce??{},r;return cL(t)&&(r=t.enumValues.length?n.enum(t.enumValues):n.string()),r||(Le(t,["PgGeometry","PgPointTuple"])?r=n.tuple([n.number(),n.number()]):Le(t,["PgGeometryObject","PgPointObject"])?r=n.object({x:n.number(),y:n.number()}):Le(t,["PgHalfVector","PgVector"])?(r=n.array(n.number()),r=t.dimensions?r.length(t.dimensions):r):Le(t,["PgLine"])?r=n.tuple([n.number(),n.number(),n.number()]):Le(t,["PgLineABC"])?r=n.object({a:n.number(),b:n.number(),c:n.number()}):Le(t,["PgArray"])?(r=n.array(c8(t.baseColumn,n)),r=t.size?r.length(t.size):r):t.dataType==="array"?r=n.array(n.any()):t.dataType==="number"?r=dL(t,n,i):t.dataType==="bigint"?r=fL(t,n,i):t.dataType==="boolean"?r=i===!0||i.boolean?n.coerce.boolean():n.boolean():t.dataType==="date"?r=i===!0||i.date?n.coerce.date():n.date():t.dataType==="string"?r=mL(t,n,i):t.dataType==="json"?r=lL:t.dataType==="custom"?r=n.any():t.dataType==="buffer"&&(r=pL)),r||(r=n.any()),r}function dL(t,e,n){let i=t.getSQLType().includes("unsigned"),r,a,s=!1;Le(t,["MySqlTinyInt","SingleStoreTinyInt"])?(r=i?0:Ie.INT8_MIN,a=i?Ie.INT8_UNSIGNED_MAX:Ie.INT8_MAX,s=!0):Le(t,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(r=i?0:Ie.INT16_MIN,a=i?Ie.INT16_UNSIGNED_MAX:Ie.INT16_MAX,s=!0):Le(t,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(r=i?0:Ie.INT24_MIN,a=i?Ie.INT24_UNSIGNED_MAX:Ie.INT24_MAX,s=Le(t,["MySqlMediumInt","SingleStoreMediumInt"])):Le(t,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(r=i?0:Ie.INT32_MIN,a=i?Ie.INT32_UNSIGNED_MAX:Ie.INT32_MAX,s=!0):Le(t,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(r=i?0:Ie.INT48_MIN,a=i?Ie.INT48_UNSIGNED_MAX:Ie.INT48_MAX):Le(t,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(i=i||Le(t,["MySqlSerial","SingleStoreSerial"]),r=i?0:Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER,s=!0):Le(t,["MySqlYear","SingleStoreYear"])?(r=1901,a=2155,s=!0):(r=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER);let o=n===!0||n?.number?e.coerce.number():e.number();return o=o.min(r).max(a),s?o.int():o}function fL(t,e,n){let i=t.getSQLType().includes("unsigned"),r=i?0n:Ie.INT64_MIN,a=i?Ie.INT64_UNSIGNED_MAX:Ie.INT64_MAX;return(n===!0||n?.bigint?e.coerce.bigint():e.bigint()).min(r).max(a)}function mL(t,e,n){if(Le(t,["PgUUID"]))return e.string().uuid();let i,r,a=!1;Le(t,["PgVarchar","SQLiteText"])?i=t.length:Le(t,["MySqlVarChar","SingleStoreVarChar"])?i=t.length??Ie.INT16_UNSIGNED_MAX:Le(t,["MySqlText","SingleStoreText"])&&(t.textType==="longtext"?i=Ie.INT32_UNSIGNED_MAX:t.textType==="mediumtext"?i=Ie.INT24_UNSIGNED_MAX:t.textType==="text"?i=Ie.INT16_UNSIGNED_MAX:i=Ie.INT8_UNSIGNED_MAX),Le(t,["PgChar","MySqlChar","SingleStoreChar"])&&(i=t.length,a=!0),Le(t,["PgBinaryVector"])&&(r=/^[01]+$/,i=t.dimensions);let s=n===!0||n?.string?e.coerce.string():e.string();return s=r?s.regex(r):s,i&&a?s.length(i):i?s.max(i):s}function u8(t){return Xd(t)?tr(t):rC(t)}function l8(t,e,n,i){let r={};for(let[a,s]of Object.entries(t)){if(!S(s,fe)&&!S(s,F)&&!S(s,F.Aliased)&&typeof s=="object"){let p=Xd(s)||jS(s)?u8(s):s;r[a]=l8(p,e[a]??{},n,i);continue}let o=e[a];if(o!==void 0&&typeof o!="function"){r[a]=o;continue}let c=S(s,fe)?s:void 0,u=c?c8(c,i):xe.any(),l=typeof o=="function"?o(u):u;n.never(c)||(r[a]=l,c&&(n.nullable(c)&&(r[a]=r[a].nullable()),n.optional(c)&&(r[a]=r[a].optional())))}return xe.object(r)}var Ie,uL,lL,pL,hL,dt,p8=k(()=>{ms();Id();Ie={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-0x800000000000,INT48_MAX:0x7fffffffffff,INT48_UNSIGNED_MAX:0xffffffffffff,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};uL=xe.union([xe.string(),xe.number(),xe.boolean(),xe.null()]),lL=xe.union([uL,xe.record(xe.any()),xe.array(xe.any())]),pL=xe.custom(t=>t instanceof Buffer);hL={never:t=>t?.generated?.type==="always"||t?.generatedIdentity?.type==="always",optional:t=>!t.notNull||t.notNull&&t.hasDefault,nullable:t=>!t.notNull},dt=(t,e)=>{let n=u8(t);return l8(n,e??{},hL)}});var Fv={};al(Fv,{ALL_PERMISSIONS:()=>SL,categories:()=>rn,customers:()=>Ce,deliveries:()=>Rt,employees:()=>Tt,insertCategorySchema:()=>Iv,insertCustomerSchema:()=>Nv,insertDeliverySchema:()=>qv,insertEmployeeSchema:()=>jv,insertPlanSchema:()=>vL,insertProductSchema:()=>Ov,insertPurchaseItemSchema:()=>wL,insertPurchaseSchema:()=>bL,insertRoleSchema:()=>Av,insertSaleItemSchema:()=>yL,insertSaleSchema:()=>xL,insertSettingSchema:()=>_L,insertSupplierSchema:()=>Rv,insertTenantSchema:()=>gL,plans:()=>Ht,products:()=>we,purchaseItems:()=>gi,purchases:()=>Wt,roles:()=>qt,saleItems:()=>Gn,sales:()=>rt,settings:()=>sn,suppliers:()=>an,tenants:()=>qe});var Ht,vL,qe,gL,qt,Av,Tt,jv,rn,Iv,we,Ov,Ce,Nv,rt,xL,Gn,yL,Rt,qv,an,Rv,Wt,bL,gi,wL,sn,_L,SL,Os=k(()=>{"use strict";ms();Sv();p8();Ht=Xe("plans",{id:ee("id").primaryKey().default(y`gen_random_uuid()`),name:Y("name").notNull().unique(),slug:Y("slug").notNull().unique(),price:Ct("price",{precision:12,scale:2}).notNull().default("0"),maxProducts:Cn("max_products").notNull().default(100),maxEmployees:Cn("max_employees").notNull().default(3),features:ss("features").notNull().default(y`'[]'::jsonb`),active:Vn("active").notNull().default(!0),sortOrder:Cn("sort_order").notNull().default(0)}),vL=dt(Ht).omit({id:!0}),qe=Xe("tenants",{id:ee("id").primaryKey().default(y`gen_random_uuid()`),name:Y("name").notNull(),ownerName:Y("owner_name").notNull(),phone:Y("phone").notNull().unique(),password:Y("password").notNull(),plan:Y("plan").notNull().default("free"),active:Vn("active").notNull().default(!0),createdAt:nr("created_at").notNull().defaultNow()}),gL=dt(qe).omit({id:!0,createdAt:!0}),qt=Xe("roles",{id:ee("id").primaryKey().default(y`gen_random_uuid()`),tenantId:ee("tenant_id").references(()=>qe.id),name:Y("name").notNull(),permissions:ss("permissions").notNull().default(y`'[]'::jsonb`)}),Av=dt(qt).omit({id:!0}),Tt=Xe("employees",{id:ee("id").primaryKey().default(y`gen_random_uuid()`),tenantId:ee("tenant_id").references(()=>qe.id),fullName:Y("full_name").notNull(),phone:Y("phone").notNull(),username:Y("username").notNull(),password:Y("password").notNull(),roleId:ee("role_id").references(()=>qt.id),active:Vn("active").notNull().default(!0)}),jv=dt(Tt).omit({id:!0}),rn=Xe("categories",{id:ee("id").primaryKey().default(y`gen_random_uuid()`),tenantId:ee("tenant_id").references(()=>qe.id),name:Y("name").notNull(),description:Y("description")}),Iv=dt(rn).omit({id:!0}),we=Xe("products",{id:ee("id").primaryKey().default(y`gen_random_uuid()`),tenantId:ee("tenant_id").references(()=>qe.id),name:Y("name").notNull(),description:Y("description"),sku:Y("sku").notNull(),price:Ct("price",{precision:12,scale:2}).notNull(),costPrice:Ct("cost_price",{precision:12,scale:2}).notNull(),stock:Cn("stock").notNull().default(0),minStock:Cn("min_stock").notNull().default(5),categoryId:ee("category_id").references(()=>rn.id),imageUrl:Y("image_url"),unit:Y("unit").notNull().default("dona"),active:Vn("active").notNull().default(!0)}),Ov=dt(we).omit({id:!0}),Ce=Xe("customers",{id:ee("id").primaryKey().default(y`gen_random_uuid()`),tenantId:ee("tenant_id").references(()=>qe.id),fullName:Y("full_name").notNull(),phone:Y("phone").notNull(),password:Y("password"),address:Y("address"),telegramId:Y("telegram_id"),debt:Ct("debt",{precision:12,scale:2}).notNull().default("0"),active:Vn("active").notNull().default(!0)}),Nv=dt(Ce).omit({id:!0}),rt=Xe("sales",{id:ee("id").primaryKey().default(y`gen_random_uuid()`),tenantId:ee("tenant_id").references(()=>qe.id),customerId:ee("customer_id").references(()=>Ce.id),employeeId:ee("employee_id").references(()=>Tt.id),totalAmount:Ct("total_amount",{precision:12,scale:2}).notNull(),discount:Ct("discount",{precision:12,scale:2}).notNull().default("0"),paidAmount:Ct("paid_amount",{precision:12,scale:2}).notNull(),paymentType:Y("payment_type").notNull().default("cash"),status:Y("status").notNull().default("completed"),createdAt:nr("created_at").notNull().defaultNow()}),xL=dt(rt).omit({id:!0,createdAt:!0}),Gn=Xe("sale_items",{id:ee("id").primaryKey().default(y`gen_random_uuid()`),saleId:ee("sale_id").references(()=>rt.id).notNull(),productId:ee("product_id").references(()=>we.id).notNull(),quantity:Cn("quantity").notNull(),price:Ct("price",{precision:12,scale:2}).notNull(),total:Ct("total",{precision:12,scale:2}).notNull()}),yL=dt(Gn).omit({id:!0}),Rt=Xe("deliveries",{id:ee("id").primaryKey().default(y`gen_random_uuid()`),tenantId:ee("tenant_id").references(()=>qe.id),saleId:ee("sale_id").references(()=>rt.id).notNull(),customerId:ee("customer_id").references(()=>Ce.id).notNull(),address:Y("address").notNull(),status:Y("status").notNull().default("pending"),notes:Y("notes"),createdAt:nr("created_at").notNull().defaultNow()}),qv=dt(Rt).omit({id:!0,createdAt:!0}),an=Xe("suppliers",{id:ee("id").primaryKey().default(y`gen_random_uuid()`),tenantId:ee("tenant_id").references(()=>qe.id),name:Y("name").notNull(),phone:Y("phone"),company:Y("company"),address:Y("address"),active:Vn("active").notNull().default(!0)}),Rv=dt(an).omit({id:!0}),Wt=Xe("purchases",{id:ee("id").primaryKey().default(y`gen_random_uuid()`),tenantId:ee("tenant_id").references(()=>qe.id),supplierId:ee("supplier_id").references(()=>an.id),totalAmount:Ct("total_amount",{precision:12,scale:2}).notNull(),paidAmount:Ct("paid_amount",{precision:12,scale:2}).notNull().default("0"),notes:Y("notes"),createdAt:nr("created_at").notNull().defaultNow()}),bL=dt(Wt).omit({id:!0,createdAt:!0}),gi=Xe("purchase_items",{id:ee("id").primaryKey().default(y`gen_random_uuid()`),purchaseId:ee("purchase_id").references(()=>Wt.id).notNull(),productId:ee("product_id").references(()=>we.id).notNull(),quantity:Cn("quantity").notNull(),costPrice:Ct("cost_price",{precision:12,scale:2}).notNull(),total:Ct("total",{precision:12,scale:2}).notNull()}),wL=dt(gi).omit({id:!0}),sn=Xe("settings",{id:ee("id").primaryKey().default(y`gen_random_uuid()`),tenantId:ee("tenant_id").references(()=>qe.id),key:Y("key").notNull(),value:Y("value").notNull()}),_L=dt(sn).omit({id:!0}),SL=["pos.sell","pos.discount","pos.debt_sale","customers.view","customers.create","customers.edit","products.view","products.create","products.edit","products.stock","warehouse.view","roles.view","roles.manage","employees.view","employees.manage","deliveries.view","deliveries.manage","settings.manage","reports.view"]});var CL,L,Dv=k(()=>{"use strict";uu();o8();Os();if(!process.env.DATABASE_URL)throw new Error("DATABASE_URL must be set");CL=new I2({connectionString:process.env.DATABASE_URL}),L=ju(CL,{schema:Fv})});var Mv,P,Lv=k(()=>{"use strict";ms();Dv();Os();Mv=class{async getPlans(){return await L.select().from(Ht).orderBy(Ht.sortOrder)}async getPlan(e){let[n]=await L.select().from(Ht).where(B(Ht.id,e));return n}async createPlan(e){let[n]=await L.insert(Ht).values(e).returning();return n}async updatePlan(e,n){let[i]=await L.update(Ht).set(n).where(B(Ht.id,e)).returning();return i}async deletePlan(e){await L.delete(Ht).where(B(Ht.id,e))}async getAllTenants(){return await L.select().from(qe).orderBy(li(qe.createdAt))}async createTenant(e){let[n]=await L.insert(qe).values(e).returning();return n}async getTenant(e){let[n]=await L.select().from(qe).where(B(qe.id,e));return n}async getTenantByPhone(e){let[n]=await L.select().from(qe).where(B(qe.phone,e));return n}async updateTenant(e,n){let[i]=await L.update(qe).set(n).where(B(qe.id,e)).returning();return i}async getRoles(e){return await L.select().from(qt).where(B(qt.tenantId,e))}async getRole(e){let[n]=await L.select().from(qt).where(B(qt.id,e));return n}async createRole(e){let[n]=await L.insert(qt).values(e).returning();return n}async updateRole(e,n){let[i]=await L.update(qt).set(n).where(B(qt.id,e)).returning();return i}async deleteRole(e){await L.delete(qt).where(B(qt.id,e))}async getEmployees(e){return await L.select().from(Tt).where(B(Tt.tenantId,e))}async getEmployee(e){let[n]=await L.select().from(Tt).where(B(Tt.id,e));return n}async getEmployeeByUsername(e,n){let[i]=await L.select().from(Tt).where(zn(B(Tt.username,e),B(Tt.tenantId,n)));return i}async createEmployee(e){let[n]=await L.insert(Tt).values(e).returning();return n}async updateEmployee(e,n){let[i]=await L.update(Tt).set(n).where(B(Tt.id,e)).returning();return i}async getCategories(e){return await L.select().from(rn).where(B(rn.tenantId,e))}async createCategory(e){let[n]=await L.insert(rn).values(e).returning();return n}async updateCategory(e,n){let[i]=await L.update(rn).set(n).where(B(rn.id,e)).returning();return i}async deleteCategory(e){await L.delete(rn).where(B(rn.id,e))}async getProducts(e){return await L.select().from(we).where(B(we.tenantId,e))}async getProduct(e){let[n]=await L.select().from(we).where(B(we.id,e));return n}async createProduct(e){let[n]=await L.insert(we).values(e).returning();return n}async updateProduct(e,n){let[i]=await L.update(we).set(n).where(B(we.id,e)).returning();return i}async getCustomers(e){return await L.select().from(Ce).where(B(Ce.tenantId,e))}async getCustomer(e){let[n]=await L.select().from(Ce).where(B(Ce.id,e));return n}async getCustomerByPhone(e,n){let[i]=await L.select().from(Ce).where(zn(B(Ce.phone,e),B(Ce.tenantId,n)));return i}async getCustomerByTelegramId(e){let[n]=await L.select().from(Ce).where(B(Ce.telegramId,e));return n}async getCustomerSales(e){return await L.select().from(rt).where(B(rt.customerId,e)).orderBy(li(rt.createdAt))}async createCustomer(e){let[n]=await L.insert(Ce).values(e).returning();return n}async updateCustomer(e,n){let[i]=await L.update(Ce).set(n).where(B(Ce.id,e)).returning();return i}async getSales(e){return await L.select().from(rt).where(B(rt.tenantId,e)).orderBy(li(rt.createdAt))}async getSale(e){let[n]=await L.select().from(rt).where(B(rt.id,e));return n}async createSale(e){let[n]=await L.insert(rt).values(e).returning();return n}async getSaleItems(e){return await L.select().from(Gn).where(B(Gn.saleId,e))}async createSaleItem(e){let[n]=await L.insert(Gn).values(e).returning();return n}async getDeliveries(e){return await L.select().from(Rt).where(B(Rt.tenantId,e)).orderBy(li(Rt.createdAt))}async getDelivery(e){let[n]=await L.select().from(Rt).where(B(Rt.id,e));return n}async createDelivery(e){let[n]=await L.insert(Rt).values(e).returning();return n}async updateDelivery(e,n){let[i]=await L.update(Rt).set(n).where(B(Rt.id,e)).returning();return i}async getSettings(e){return await L.select().from(sn).where(B(sn.tenantId,e))}async getSetting(e,n){let[i]=await L.select().from(sn).where(zn(B(sn.key,e),B(sn.tenantId,n)));return i}async upsertSetting(e,n,i){let r=await this.getSetting(e,i);if(r){let[s]=await L.update(sn).set({value:n}).where(B(sn.id,r.id)).returning();return s}let[a]=await L.insert(sn).values({key:e,value:n,tenantId:i}).returning();return a}async getSuppliers(e){return await L.select().from(an).where(B(an.tenantId,e))}async getSupplier(e){let[n]=await L.select().from(an).where(B(an.id,e));return n}async createSupplier(e){let[n]=await L.insert(an).values(e).returning();return n}async updateSupplier(e,n){let[i]=await L.update(an).set(n).where(B(an.id,e)).returning();return i}async getPurchases(e){return await L.select().from(Wt).where(B(Wt.tenantId,e)).orderBy(li(Wt.createdAt))}async getPurchase(e){let[n]=await L.select().from(Wt).where(B(Wt.id,e));return n}async createPurchase(e){let[n]=await L.insert(Wt).values(e).returning();return n}async getPurchaseItems(e){return await L.select().from(gi).where(B(gi.purchaseId,e))}async createPurchaseItem(e){let[n]=await L.insert(gi).values(e).returning();return n}},P=new Mv});var h8=g(Bv=>{var d8=/; *([!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) *= *("(?:[ !\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u0020-\u007e])*"|[!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) */g,EL=/^[\u0020-\u007e\u0080-\u00ff]+$/,m8=/^[!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+$/,kL=/\\([\u0000-\u007f])/g,TL=/([\\"])/g,PL=/^[A-Za-z0-9][A-Za-z0-9!#$&^_.-]{0,126}$/,f8=/^[A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126}$/,AL=/^ *([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126}) *$/;Bv.format=jL;Bv.parse=IL;function jL(t){if(!t||typeof t!="object")throw new TypeError("argument obj is required");var e=t.parameters,n=t.subtype,i=t.suffix,r=t.type;if(!r||!f8.test(r))throw new TypeError("invalid type");if(!n||!PL.test(n))throw new TypeError("invalid subtype");var a=r+"/"+n;if(i){if(!f8.test(i))throw new TypeError("invalid suffix");a+="+"+i}if(e&&typeof e=="object")for(var s,o=Object.keys(e).sort(),c=0;c<o.length;c++){if(s=o[c],!m8.test(s))throw new TypeError("invalid parameter name");a+="; "+s+"="+NL(e[s])}return a}function IL(t){if(!t)throw new TypeError("argument string is required");if(typeof t=="object"&&(t=OL(t)),typeof t!="string")throw new TypeError("argument string is required to be a string");var e=t.indexOf(";"),n=e!==-1?t.substr(0,e):t,i,r,a=qL(n),s={},o;for(d8.lastIndex=e;r=d8.exec(t);){if(r.index!==e)throw new TypeError("invalid parameter format");e+=r[0].length,i=r[1].toLowerCase(),o=r[2],o[0]==='"'&&(o=o.substr(1,o.length-2).replace(kL,"$1")),s[i]=o}if(e!==-1&&e!==t.length)throw new TypeError("invalid parameter format");return a.parameters=s,a}function OL(t){if(typeof t.getHeader=="function")return t.getHeader("content-type");if(typeof t.headers=="object")return t.headers&&t.headers["content-type"]}function NL(t){var e=String(t);if(m8.test(e))return e;if(e.length>0&&!EL.test(e))throw new TypeError("invalid parameter value");return'"'+e.replace(TL,"\\$1")+'"'}function qL(t){var e=AL.exec(t.toLowerCase());if(!e)throw new TypeError("invalid media type");var n=e[1],i=e[2],r,a=i.lastIndexOf("+");a!==-1&&(r=i.substr(a+1),i=i.substr(0,a));var s={type:n,subtype:i,suffix:r};return s}});var v8=g((bie,RL)=>{RL.exports={"application/1d-interleaved-parityfec":{source:"iana"},"application/3gpdash-qoe-report+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/3gpp-ims+xml":{source:"iana",compressible:!0},"application/3gpphal+json":{source:"iana",compressible:!0},"application/3gpphalforms+json":{source:"iana",compressible:!0},"application/a2l":{source:"iana"},"application/ace+cbor":{source:"iana"},"application/activemessage":{source:"iana"},"application/activity+json":{source:"iana",compressible:!0},"application/alto-costmap+json":{source:"iana",compressible:!0},"application/alto-costmapfilter+json":{source:"iana",compressible:!0},"application/alto-directory+json":{source:"iana",compressible:!0},"application/alto-endpointcost+json":{source:"iana",compressible:!0},"application/alto-endpointcostparams+json":{source:"iana",compressible:!0},"application/alto-endpointprop+json":{source:"iana",compressible:!0},"application/alto-endpointpropparams+json":{source:"iana",compressible:!0},"application/alto-error+json":{source:"iana",compressible:!0},"application/alto-networkmap+json":{source:"iana",compressible:!0},"application/alto-networkmapfilter+json":{source:"iana",compressible:!0},"application/alto-updatestreamcontrol+json":{source:"iana",compressible:!0},"application/alto-updatestreamparams+json":{source:"iana",compressible:!0},"application/aml":{source:"iana"},"application/andrew-inset":{source:"iana",extensions:["ez"]},"application/applefile":{source:"iana"},"application/applixware":{source:"apache",extensions:["aw"]},"application/at+jwt":{source:"iana"},"application/atf":{source:"iana"},"application/atfx":{source:"iana"},"application/atom+xml":{source:"iana",compressible:!0,extensions:["atom"]},"application/atomcat+xml":{source:"iana",compressible:!0,extensions:["atomcat"]},"application/atomdeleted+xml":{source:"iana",compressible:!0,extensions:["atomdeleted"]},"application/atomicmail":{source:"iana"},"application/atomsvc+xml":{source:"iana",compressible:!0,extensions:["atomsvc"]},"application/atsc-dwd+xml":{source:"iana",compressible:!0,extensions:["dwd"]},"application/atsc-dynamic-event-message":{source:"iana"},"application/atsc-held+xml":{source:"iana",compressible:!0,extensions:["held"]},"application/atsc-rdt+json":{source:"iana",compressible:!0},"application/atsc-rsat+xml":{source:"iana",compressible:!0,extensions:["rsat"]},"application/atxml":{source:"iana"},"application/auth-policy+xml":{source:"iana",compressible:!0},"application/bacnet-xdd+zip":{source:"iana",compressible:!1},"application/batch-smtp":{source:"iana"},"application/bdoc":{compressible:!1,extensions:["bdoc"]},"application/beep+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/calendar+json":{source:"iana",compressible:!0},"application/calendar+xml":{source:"iana",compressible:!0,extensions:["xcs"]},"application/call-completion":{source:"iana"},"application/cals-1840":{source:"iana"},"application/captive+json":{source:"iana",compressible:!0},"application/cbor":{source:"iana"},"application/cbor-seq":{source:"iana"},"application/cccex":{source:"iana"},"application/ccmp+xml":{source:"iana",compressible:!0},"application/ccxml+xml":{source:"iana",compressible:!0,extensions:["ccxml"]},"application/cdfx+xml":{source:"iana",compressible:!0,extensions:["cdfx"]},"application/cdmi-capability":{source:"iana",extensions:["cdmia"]},"application/cdmi-container":{source:"iana",extensions:["cdmic"]},"application/cdmi-domain":{source:"iana",extensions:["cdmid"]},"application/cdmi-object":{source:"iana",extensions:["cdmio"]},"application/cdmi-queue":{source:"iana",extensions:["cdmiq"]},"application/cdni":{source:"iana"},"application/cea":{source:"iana"},"application/cea-2018+xml":{source:"iana",compressible:!0},"application/cellml+xml":{source:"iana",compressible:!0},"application/cfw":{source:"iana"},"application/city+json":{source:"iana",compressible:!0},"application/clr":{source:"iana"},"application/clue+xml":{source:"iana",compressible:!0},"application/clue_info+xml":{source:"iana",compressible:!0},"application/cms":{source:"iana"},"application/cnrp+xml":{source:"iana",compressible:!0},"application/coap-group+json":{source:"iana",compressible:!0},"application/coap-payload":{source:"iana"},"application/commonground":{source:"iana"},"application/conference-info+xml":{source:"iana",compressible:!0},"application/cose":{source:"iana"},"application/cose-key":{source:"iana"},"application/cose-key-set":{source:"iana"},"application/cpl+xml":{source:"iana",compressible:!0,extensions:["cpl"]},"application/csrattrs":{source:"iana"},"application/csta+xml":{source:"iana",compressible:!0},"application/cstadata+xml":{source:"iana",compressible:!0},"application/csvm+json":{source:"iana",compressible:!0},"application/cu-seeme":{source:"apache",extensions:["cu"]},"application/cwt":{source:"iana"},"application/cybercash":{source:"iana"},"application/dart":{compressible:!0},"application/dash+xml":{source:"iana",compressible:!0,extensions:["mpd"]},"application/dash-patch+xml":{source:"iana",compressible:!0,extensions:["mpp"]},"application/dashdelta":{source:"iana"},"application/davmount+xml":{source:"iana",compressible:!0,extensions:["davmount"]},"application/dca-rft":{source:"iana"},"application/dcd":{source:"iana"},"application/dec-dx":{source:"iana"},"application/dialog-info+xml":{source:"iana",compressible:!0},"application/dicom":{source:"iana"},"application/dicom+json":{source:"iana",compressible:!0},"application/dicom+xml":{source:"iana",compressible:!0},"application/dii":{source:"iana"},"application/dit":{source:"iana"},"application/dns":{source:"iana"},"application/dns+json":{source:"iana",compressible:!0},"application/dns-message":{source:"iana"},"application/docbook+xml":{source:"apache",compressible:!0,extensions:["dbk"]},"application/dots+cbor":{source:"iana"},"application/dskpp+xml":{source:"iana",compressible:!0},"application/dssc+der":{source:"iana",extensions:["dssc"]},"application/dssc+xml":{source:"iana",compressible:!0,extensions:["xdssc"]},"application/dvcs":{source:"iana"},"application/ecmascript":{source:"iana",compressible:!0,extensions:["es","ecma"]},"application/edi-consent":{source:"iana"},"application/edi-x12":{source:"iana",compressible:!1},"application/edifact":{source:"iana",compressible:!1},"application/efi":{source:"iana"},"application/elm+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/elm+xml":{source:"iana",compressible:!0},"application/emergencycalldata.cap+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/emergencycalldata.comment+xml":{sonpm warn config production Use `--omit=dev` instead.